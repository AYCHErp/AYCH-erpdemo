<?xml version="1.0" encoding="UTF-8"?>
<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->

<screens xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/widget-screen.xsd">
    <screen name="main-decorator">
        <section>
            <actions>
                <!-- base/top/specific map first, then more common map added for shared labels -->
                <property-map resource="ProductUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="WorkEffortUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="PartyUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="AccountingUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="ContentUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="CommonUiLabels" map-name="uiLabelMap" global="true"/>

                <set field="layoutSettings.companyName" from-field="uiLabelMap.ProductCatalogCompanyName" global="true"/>
                <set field="layoutSettings.companySubtitle" from-field="uiLabelMap.ProductCompanySubtitle" global="true"/>
                <!-- layoutSettings.headerImageUrl can be used to specify an application specific logo; if not set,
                     then the global layoutSettings.commonHeaderImageUrl (specified in GlobalDecorator) will be used. -->
                <!--<set field="layoutSettings.headerImageUrl" value="/images/ofbiz_logo.gif" global="true"/>-->
                <!-- <set field="layoutSettings.headerMiddleBackgroundUrl" value="" global="true"/> -->
                <!-- <set field="layoutSettings.headerRightBackgroundUrl" value="" global="true"/> -->
                <set field="activeApp" value="catalogmgr" global="true"/>
                <set field="applicationMenuName" value="CatalogAppBar" global="true"/>
                <set field="applicationMenuLocation" value="component://product/widget/catalog/CatalogMenus.xml" global="true"/>
                <set field="applicationTitle" value="${uiLabelMap.ProductCatalog}" global="true"/>
                
                <!-- ToDo: Move to themes? -->
                <set field="layoutSettings.javaScripts[+0]" value="/base-theme/bower_components/jquery.cookie/jquery.cookie.js" global="true"/>    
                <set field="layoutSettings.styleSheets[+0]" value="/base-theme/bower_components/jstree/dist/themes/default/style.css" global="true"/>
                <set field="layoutSettings.javaScripts[+0]" value="/base-theme/bower_components/jstree/dist/jstree.min.js" global="true"/>      
                
                <!-- main-decorator special sidebar config -->
                <set field="showMainRegularBar" from-field="showMainRegularBar" default-value="true" />
                <set field="showMainExtendedBar" from-field="showMainExtendedBar" default-value="false" />                       
            </actions>
            <widgets>
                <decorator-screen name="ApplicationDecorator" location="component://commonext/widget/CommonScreens.xml" auto-decorator-section-include="true">
                    <decorator-section name="left-column" use-when="${context.widePage != true}"> <!-- override-by-auto-include="true" -->
                        <section>
                            <condition>
                                <not><if-empty-section section-name="left-column" /></not>
                            </condition>
                            <widgets>
                                <decorator-section-include name="left-column"/>
                            </widgets>
                            <fail-widgets>
                                <!-- provide default column for all others -->
                                <include-screen name="DefMainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                           </fail-widgets>
                        </section>
                        <section>
                            <condition>
                                <if-compare field="showMainExtendedBar" operator="equals" type="Boolean" value="true"/>
                            </condition>
                            <widgets>
                                <include-screen name="leftbar" />
                            </widgets>
                        </section>
                    </decorator-section>
                    <decorator-section name="body">
                        <decorator-section-include name="body"/>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <!-- SCIPIO: App-wide common decorator for DIRECT inclusion using hardcoded location, NOT mainDecoratorLocation; simplifies the other decorators and screens -->
    <screen name="CommonCatalogAppDecorator">
        <section>
            <actions>
            </actions>
            <widgets>
                <decorator-screen name="main-decorator" location="${parameters.mainDecoratorLocation}" auto-decorator-section-include="true">
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <include-screen name="CommonSideBarMenu"/>
                    </decorator-section>
                    <decorator-section name="body">
                        <decorator-section-include name="body"/>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="CommonCatalogDecorator">
        <section>
            <actions>
                <property-map resource="ProductUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="activeSubMenu" from-field="activeSubMenu" default-value="component://product/widget/catalog/CatalogMenus.xml#Catalog" />
                <set field="activeMainMenuItem" from-field="activeMainMenuItem" default-value="catalogs"/>
                <set field="prodCatalogId" from-field="parameters.prodCatalogId" global="true"/>
                <entity-one entity-name="ProdCatalog" value-field="prodCatalog" />
                <set field="showMainExtendedBar" type="Boolean" value="true" />
                
                <set field="titleKey" from-field="labelTitleProperty" default-value="${titleProperty}" />
                <set field="title" from-field="title" default-value="${uiLabelMap[titleKey]} ${parameters.prodCatalogId}"/>
                <set field="title" value="${title} ${${extraFunctionName}}" />
            </actions>
            <widgets>
                <decorator-screen name="CommonCatalogAppDecorator">
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <section>
                            <condition>
                                <not><if-empty field="prodCatalog"/></not>
                            </condition>
                            <widgets>
                                <include-screen name="MainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                            </widgets>
                            <fail-widgets>
                                <section share-scope="false">
                                    <actions>
                                        <set field="activeSubMenu" value="TOP"/>
                                        <set field="activeSubMenuItem" from-field="activeMainMenuItem"/>
                                    </actions>
                                    <widgets>
                                        <include-screen name="MainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                                    </widgets>
                                </section>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <or>
                                    <if-has-permission permission="CATALOG" action="_ADMIN"/>
                                    <if-has-permission permission="CATALOG" action="_CREATE"/>
                                    <if-has-permission permission="CATALOG" action="_UPDATE"/>
                                    <if-has-permission permission="CATALOG" action="_VIEW"/>
                                </or>
                            </condition>
                            <actions>
                                <!-- <set field="prodCatalogId" from-field="parameters.prodCatalogId"/>
                                <entity-one entity-name="ProdCatalog" value-field="prodCatalog"/> -->
                            </actions>
                            <widgets>
                                <section>
                                    <condition>
                                        <not><if-empty field="prodCatalog"/></not>
                                    </condition>
                                    <widgets>
                                        <include-menu name="CatalogSubTabBar" location="component://product/widget/catalog/CatalogMenus.xml"/>
                                        <!-- <label style="heading">${uiLabelMap.PageTitleEditProductCatalog} [${prodCatalogId}]</label> -->
                                    </widgets>
                                    <fail-widgets>
                                        <section>
                                            <condition>
                                                <if-compare operator="not-equals" value="ProductCatalog" field="activeSubMenuItem"/>
                                            </condition>
                                            <widgets>
                                                <include-menu name="CatalogSubTabBar" location="component://product/widget/catalog/CatalogMenus.xml"/>
                                            </widgets>
                                        </section>
                                    </fail-widgets>
                                </section>
                                <decorator-section-include name="body"/>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.ProductCatalogViewPermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="CommonCategoryDecorator">
        <section>
            <actions>
                <property-map resource="ProductUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="activeSubMenu" from-field="activeSubMenu" default-value="component://product/widget/catalog/CatalogMenus.xml#Category" />
                <set field="activeMainMenuItem" from-field="activeMainMenuItem" default-value="categories"/>
                <set field="productCategoryId" from-field="parameters.productCategoryId"/>
                <entity-one entity-name="ProductCategory" value-field="productCategory"/>
                <set field="showMainExtendedBar" type="Boolean" value="true" />
                
                <set field="titleKey" from-field="labelTitleProperty" default-value="${titleProperty}" />
                <set field="title" from-field="title" default-value="${uiLabelMap[titleKey]} ${parameters.productCategoryId}"/>
                <set field="title" value="${title} ${${extraFunctionName}}" />
            </actions>
            <widgets>
                <decorator-screen name="CommonCatalogAppDecorator">
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <section>
                            <condition>
                                <not><if-empty field="productCategory"/></not>
                            </condition>
                            <widgets>
                                <include-screen name="MainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                            </widgets>
                            <fail-widgets>
                                <section share-scope="false">
                                    <actions>
                                        <set field="activeSubMenu" value="TOP"/>
                                        <set field="activeSubMenuItem" from-field="activeMainMenuItem"/>
                                    </actions>
                                    <widgets>
                                        <include-screen name="MainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                                    </widgets>
                                </section>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <or>
                                    <if-has-permission permission="CATALOG" action="_ADMIN"/>
                                    <if-has-permission permission="CATALOG" action="_CREATE"/>
                                    <if-has-permission permission="CATALOG" action="_UPDATE"/>
                                    <if-has-permission permission="CATALOG" action="_VIEW"/>
                                </or>
                            </condition>
                            <actions>
                                <set field="productCategoryId" from-field="parameters.productCategoryId"/>
                                <entity-one entity-name="ProductCategory" value-field="productCategory"/>
                            </actions>
                            <widgets>
                                <section>
                                    <condition>
                                        <and>
                                            <not><if-empty field="productCategory"/></not>
                                            <not><if-empty field="TabBarName"/></not>                                            
                                        </and>                                        
                                    </condition>
                                    <widgets>
                                        <include-menu name="${TabBarName}" location="component://product/widget/catalog/CatalogMenus.xml"/>                                        
                                    </widgets>
                                    <fail-widgets>
                                        <section>
                                            <widgets>
                                                <include-menu name="CategorySubTabBar" location="component://product/widget/catalog/CatalogMenus.xml"/>
                                            </widgets>
                                        </section>
                                    </fail-widgets>
                                </section>
                                <decorator-section-include name="body"/>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.ProductCatalogViewPermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="CommonProductDecorator">
        <section>
            <actions>
                <set field="activeSubMenu" from-field="activeSubMenu" default-value="component://product/widget/catalog/CatalogMenus.xml#Product" />
                <set field="activeMainMenuItem" from-field="activeMainMenuItem" default-value="products"/>
                <property-map resource="ProductUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="PartyUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="OrderUiLabels" map-name="uiLabelMap" global="true"/>
                <!-- SCIPIO: FIXME: these global="true" will create problems, should be removed -->
                <set field="productId" from-field="parameters.productId" global="true"/>
                <entity-one entity-name="Product" value-field="product"/>
                <set field="product" from-field="product" global="true"/>
                <set field="showMainExtendedBar" type="Boolean" value="true" />
                
                <set field="titleKey" from-field="labelTitleProperty" default-value="${titleProperty}" />
                <!-- FIXME: Special lookup for labels currently missing "Product " prefix. this does not work properly in many languages. -->
                <set field="qualifiedLabel" value="${uiLabelMap[titleKey]}"/>
                <set field="titleKey" value="${groovy: (context.labelTitlePropertyFull == true || !context.labelTitleProperty)? context.titleKey : 'ProductProductQualifiedLabel'}"/>
                
                <set field="title" from-field="title" default-value="${uiLabelMap[titleKey]} ${parameters.productId}"/>
                <set field="title" value="${title} ${${extraFunctionName}}" />
                
                <!-- SCIPIO: session-based browsing aid -->
                <script location="component://product/webapp/catalog/WEB-INF/actions/product/SetProductLastProduct.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonCatalogAppDecorator">
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <section>
                            <condition>
                                <or>
                                    <if-has-permission permission="CATALOG" action="_ADMIN"/>
                                    <if-has-permission permission="CATALOG" action="_CREATE"/>
                                    <if-has-permission permission="CATALOG" action="_UPDATE"/>
                                    <if-has-permission permission="CATALOG" action="_VIEW"/>
                                </or>
                            </condition>
                            <actions>
                                <!-- SCIPIO: this seems duplicate from above and will clashes with global...
                                <set field="productId" from-field="parameters.productId"/>
                                <entity-one entity-name="Product" value-field="product"/> -->
                            </actions>
                            <widgets>
                                <section>
                                    <condition>
                                        <not><if-empty field="product"/></not>
                                    </condition>
                                    <widgets>
                                        <include-screen name="MainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                                        <!--<include-screen name="leftbar" location="component://product/widget/catalog/CommonScreens.xml"/>-->
                                        <!--<include-menu name="ProductSubTabBar" location="component://product/widget/catalog/CatalogMenus.xml"/>-->
                                    </widgets>
                                    <fail-widgets>
                                        <section share-scope="false">
                                            <actions>
                                                <set field="activeSubMenu" value="TOP"/>
                                                <set field="activeSubMenuItem" from-field="activeMainMenuItem"/>
                                            </actions>
                                            <widgets>
                                                <include-screen name="MainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                                            </widgets>
                                        </section>
                                    </fail-widgets>
                                </section>
                            </widgets>
                            <fail-widgets>
                                <include-screen name="DefMainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <or>
                                    <if-has-permission permission="CATALOG" action="_ADMIN"/>
                                    <if-has-permission permission="CATALOG" action="_CREATE"/>
                                    <if-has-permission permission="CATALOG" action="_UPDATE"/>
                                    <if-has-permission permission="CATALOG" action="_VIEW"/>
                                </or>
                            </condition>
                            <actions>
                                <!-- SCIPIO: this seems duplicate from above and will clashes with global...
                                <set field="productId" from-field="parameters.productId"/>
                                <entity-one entity-name="Product" value-field="product"/>-->
                            </actions>
                            <widgets>
                                <section>
                                    <condition>
                                        <not><if-empty field="product"/></not>
                                    </condition>
                                    <widgets>
                                        <platform-specific>
                                            <html><html-template location="component://product/webapp/catalog/menu/ProductSubTabBar.ftl"/></html>
                                        </platform-specific>
                                    </widgets>
                                    <fail-widgets>
                                        <section>
                                            <condition>
                                                <or>
                                                    <if-compare operator="not-equals" value="EditProduct" field="activeSubMenuItem"/>
                                                </or>
                                            </condition>
                                            <widgets>
                                                <platform-specific>
                                                    <html><html-template location="component://product/webapp/catalog/menu/ProductSubTabBar.ftl"/></html>
                                                </platform-specific>
                                            </widgets>
                                        </section>
                                    </fail-widgets>
                                </section>
                                <decorator-section-include name="body"/>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.ProductCatalogViewPermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="CommonConfigDecorator">
        <section>
            <actions>
                <property-map resource="ProductUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="activeSubMenu" from-field="activeSubMenu" default-value="component://product/widget/catalog/CatalogMenus.xml#ConfigItem" />
                <set field="activeMainMenuItem" from-field="activeMainMenuItem" default-value="products"/>
                <set field="showMainExtendedBar" type="Boolean" value="true" />
                
                <set field="titleKey" from-field="labelTitleProperty" default-value="${titleProperty}" />
                <set field="title" from-field="title" default-value="${uiLabelMap[titleKey]} ${parameters.configItemId}"/>
                <set field="title" value="${title} ${${extraFunctionName}}" />
                
                <!-- SCIPIO: session-based browsing aid -->
                <script location="component://product/webapp/catalog/WEB-INF/actions/product/GetProductLastProduct.groovy"/>
                <!-- re-save it to prevent wild switching -->
                <script location="component://product/webapp/catalog/WEB-INF/actions/product/SetProductLastProduct.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonCatalogAppDecorator">
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <section>
                            <condition>
                                <not><if-empty field="configItem"/></not>
                            </condition>
                            <widgets>
                                <include-screen name="MainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                            </widgets>
                            <fail-widgets>
                                <section share-scope="false">
                                    <actions>
                                        <!-- SCIPIO: FIXME?: this is hard to say what should show here, so we fall back on showing
                                            product side bar -->
                                        <set field="activeSubMenu" value="component://product/widget/catalog/CatalogMenus.xml#Product" />
                                        <set field="activeSubMenuItem" value="EditProductConfigs"/>                                        
                                    </actions>
                                    <widgets>
                                        <include-screen name="MainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                                    </widgets>
                                </section>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                    <decorator-section name="body">
                        <section>
                            <!-- do check for CATALOG, _VIEW permission -->
                            <condition>
                                <if-has-permission permission="CATALOG" action="_VIEW"/>
                            </condition>
                            <widgets>
                                <!--
                                <section>
                                    <condition><not><if-empty field="configItemId"/></not></condition>
                                    <widgets>
                                     
                                        <label style="heading">${uiLabelMap[labelTitleProperty]} ${uiLabelMap.CommonFor}: ${configItem.configItemName} [${uiLabelMap.CommonId}:${configItemId}]  ${${extraFunctionName}}</label>
                                        <container style="button-bar">
                                            <link target="EditProductConfigItem" text="${uiLabelMap.CommonNew} ${uiLabelMap.ProductConfigItem}" style="${styles.link_nav} ${styles.action_add}"/>
                                        </container>
                                          
                                    </widgets>
                                </section>
                                -->
                                <include-menu name="ConfigItemSubTabBar" location="component://product/widget/catalog/CatalogMenus.xml"/>
                                <decorator-section-include name="body"/>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.ProductCatalogViewPermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="CommonFeatureDecorator">
        <section>
            <actions>
                <property-map resource="ProductUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="activeSubMenu" from-field="activeSubMenu" default-value="component://product/widget/catalog/CatalogMenus.xml#Features" />
                <set field="activeMainMenuItem" from-field="activeMainMenuItem" default-value="products"/>

                <set field="showMainExtendedBar" type="Boolean" value="true" />
                
                <!-- SCIPIO: session-based browsing aid -->
                <script location="component://product/webapp/catalog/WEB-INF/actions/product/GetProductLastProduct.groovy"/>
                <!-- re-save it to prevent wild switching -->
                <script location="component://product/webapp/catalog/WEB-INF/actions/product/SetProductLastProduct.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonCatalogAppDecorator">
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <section>
                            <condition>
                                <or>
                                    <if-has-permission permission="CATALOG" action="_ADMIN"/>
                                    <if-has-permission permission="CATALOG" action="_CREATE"/>
                                    <if-has-permission permission="CATALOG" action="_UPDATE"/>
                                    <if-has-permission permission="CATALOG" action="_VIEW"/>
                                </or>
                            </condition>
                            <widgets>
                                <include-screen name="MainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                            </widgets>
                            <fail-widgets>
                                <!-- provide default column for all others -->
                                <include-screen name="DefMainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                            </fail-widgets>
                        </section>
                    </decorator-section>             
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <or>
                                    <if-has-permission permission="CATALOG" action="_ADMIN"/>
                                    <if-has-permission permission="CATALOG" action="_CREATE"/>
                                    <if-has-permission permission="CATALOG" action="_UPDATE"/>
                                    <if-has-permission permission="CATALOG" action="_VIEW"/>
                                </or>
                            </condition>
                            <widgets>
                                <decorator-section-include name="body"/>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.ProductCatalogViewPermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="CommonSpecificFeatureDecorator">
        <section>
            <actions>
                <property-map resource="ProductUiLabels" map-name="uiLabelMap" global="true"/>
                
                <set field="titleKey" from-field="labelTitleProperty" default-value="${titleProperty}" />
                <set field="title" from-field="title" default-value="${uiLabelMap[titleKey]} ${parameters.productFeatureId}"/>
                <set field="title" value="${title} ${${extraFunctionName}}" />
                
                <set field="productFeatureId" from-field="productFeatureId" default-value="${parameters.productFeatureId}"/>
                <entity-one entity-name="ProductFeature" value-field="productFeature" auto-field-map="true"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonFeatureDecorator">                
                    <decorator-section name="body">
                        <include-menu name="FeaturesSubTabBar" location="component://product/widget/catalog/CatalogMenus.xml" />
                        <decorator-section-include name="body"/>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="CommonPromoDecorator">
        <section>
            <actions>
                <property-map resource="ProductUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="activeSubMenu" from-field="activeSubMenu" default-value="component://product/widget/catalog/CatalogMenus.xml#Promo" />
                <set field="activeMainMenuItem" from-field="activeMainMenuItem" default-value="promos" />
                <set field="showMainExtendedBar" type="Boolean" value="true" />
                
                <set field="titleKey" from-field="labelTitleProperty" default-value="${titleProperty}" />
                <set field="title" from-field="title" default-value="${uiLabelMap[titleKey]} ${parameters.productPromoId}"/>
                <set field="title" value="${title} ${${extraFunctionName}}" />
            </actions>
            <widgets>
                <decorator-screen name="CommonCatalogAppDecorator">                
                    <decorator-section name="body">
                        <section>
                            <!-- do check for CATALOG, _VIEW permission -->
                            <condition>
                                <if-has-permission permission="CATALOG" action="_VIEW"/>
                            </condition>
                            <widgets>
                                <!--
                                <section>
                                    <condition><not><if-empty field="productPromoId"/></not></condition>
                                    <widgets>
                                        
                                        <container style="button-bar">
                                            <link target="EditProductPromo" text="${uiLabelMap.ProductNewProductPromo}" style="${styles.link_nav} ${styles.action_add}"/>
                                        </container>                                    
                                        </widgets>
                                </section>
                                -->
                                <include-menu name="PromoSubTabBar" location="component://product/widget/catalog/CatalogMenus.xml" />
                                <decorator-section-include name="body"/>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.ProductCatalogViewPermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="CommonPromoCodeDecorator">
        <section>
            <actions>
                <property-map resource="ProductUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="activeSubMenu" from-field="activeSubMenu" default-value="component://product/widget/catalog/CatalogMenus.xml#Promo" />
                <set field="activeSubMenuItem" from-field="activeSubMenuItem" default-value="FindProductPromoCode"/>
                <set field="activeMainMenuItem" from-field="activeMainMenuItem" default-value="promos" />
                <set field="showMainExtendedBar" type="Boolean" value="true" />
                
                <!-- ONLY the edit screen should do this -->
                <set field="titleKey" from-field="labelTitleProperty" default-value="${titleProperty}" />
                <set field="promoCodeTitle" value="${uiLabelMap[titleKey]} ${parameters.productPromoCodeId}" />
                <set field="title" from-field="title" default-value="${groovy: (context.usePromoCodeTitle == true) ? context.promoCodeTitle : null}"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonPromoDecorator">
                    <decorator-section name="body">
                        <!-- caller does this for now
                        <include-menu name="PromoCodeSubTabBar" location="component://product/widget/catalog/CatalogMenus.xml" />
                        -->
                        <decorator-section-include name="body"/>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="CommonProductStoreDecorator">
        <section>
            <actions>
                <property-map resource="ProductUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="PartyUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="OrderUiLabels" map-name="uiLabelMap" global="true"/>
            
                <set field="activeSubMenu" from-field="activeSubMenu" default-value="component://product/widget/catalog/CatalogMenus.xml#ProductStore" />
                <set field="activeMainMenuItem" from-field="activeMainMenuItem" default-value="store"/>
                <set field="showMainExtendedBar" type="Boolean" value="true" />
                <property-map resource="ProductUiLabels" map-name="uiLabelMap" global="true"/>
                
                <!-- SCIPIO: NOTE: This is workaround for screens that forget to set context var from parameters, so menus can work.
                    Do NOT set this global. -->
                <set field="productStoreId" from-field="productStoreId" default-value="${parameters.productStoreId}"/>

                <set field="titleKey" from-field="labelTitleProperty" default-value="${titleProperty}" />
                <set field="title" from-field="title" default-value="${uiLabelMap[titleKey]} ${productStoreId}"/>
                <set field="title" value="${title} ${${extraFunctionName}}" />
                
                <!-- SCIPIO: session-based browsing aid
                    NOTE: this is generally placed because some fallbacks don't have an accessible points -->
                <script location="component://product/webapp/catalog/WEB-INF/actions/store/SetStoreLastProductStore.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonCatalogAppDecorator">
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <section>
                            <actions>          
                                <!-- SCIPIO: this guarantees lookup for the following check. many screens already did this, but not all.
                                    Do NOT set this global. -->
                                <set field="lookupProductStoreId" from-field="productStoreId" />
                                <entity-one entity-name="ProductStore" value-field="productStore" auto-field-map="false"> 
                                    <field-map field-name="productStoreId" from-field="lookupProductStoreId"/>
                                </entity-one>  
                            </actions>
                            <widgets>
                                <section>
                                    <condition><not><if-empty field="productStore"/></not></condition>
                                    <widgets>
                                        <container>
                                            <include-screen name="MainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                                        </container>
                                    </widgets>
                                    <fail-widgets>
                                        <section share-scope="false">
                                            <actions>
                                                <set field="activeSubMenu" value="TOP"/>
                                                <set field="activeSubMenuItem" value="store"/>
                                            </actions>
                                            <widgets>
                                                <include-screen name="MainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                                            </widgets>
                                        </section>
                                    </fail-widgets>
                                </section>
                            </widgets>
                        </section>
                    </decorator-section>
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <or>
                                    <if-has-permission permission="CATALOG" action="_ADMIN"/>
                                    <if-has-permission permission="CATALOG" action="_CREATE"/>
                                    <if-has-permission permission="CATALOG" action="_UPDATE"/>
                                    <if-has-permission permission="CATALOG" action="_VIEW"/>
                                </or>
                            </condition>
                            <actions>
                                <set field="productStoreId" from-field="parameters.productStoreId"/>
                                <entity-one entity-name="ProductStore" value-field="productStore"/>
                            </actions>
                            <widgets>
                                <include-menu name="ProductStoreSubTabBar" location="component://product/widget/catalog/CatalogMenus.xml"/>
                                <decorator-section-include name="body"/>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.ProductCatalogViewPermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="CommonProductStoreGroupDecorator">
        <section>
            <actions>
                <property-map resource="ProductUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="activeSubMenu" from-field="activeSubMenu" default-value="component://product/widget/catalog/CatalogMenus.xml#ProductStore" />
                <set field="activeSubMenuItem" from-field="activeSubMenuItem" default-value="EditProductStoreGroups"/>
                <set field="activeMainMenuItem" from-field="activeMainMenuItem" default-value="store"/>
                <set field="showMainExtendedBar" type="Boolean" value="true" />
                
                <!-- SCIPIO: NOTE: This is workaround for screens that forget to set context var from parameters, so menus can work.
                    Do NOT set this global. -->
                <set field="productStoreId" from-field="productStoreId" default-value="${parameters.productStoreId}"/>
                
                <set field="titleKey" from-field="labelTitleProperty" default-value="${titleProperty}" />
                <set field="title" from-field="title" default-value="${uiLabelMap[titleKey]} ${productStoreId}"/>
                <set field="title" value="${title} ${${extraFunctionName}}" />
                
                <!-- SCIPIO: session-based browsing aid -->
                <script location="component://product/webapp/catalog/WEB-INF/actions/store/GetStoreLastProductStore.groovy"/>
                <!-- re-save it to prevent wild switching -->
                <script location="component://product/webapp/catalog/WEB-INF/actions/store/SetStoreLastProductStore.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonCatalogAppDecorator">
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <!--<include-screen name="ProductStoreGroupTree"/>-->
                        <section>
                            <condition><not><if-empty field="parameters.productStoreGroupId"/></not></condition>
                            <widgets>
                                <container>
                                    <include-screen name="MainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                                </container>
                            </widgets>
                            <fail-widgets>
                                <section share-scope="false">
                                    <actions>
                                        <set field="activeSubMenu" value="component://product/widget/catalog/CatalogMenus.xml#ProductStore" />
                                        <set field="activeSubMenuItem" value="EditProductStoreGroups"/>
                                    </actions>
                                    <widgets>
                                        <include-screen name="MainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                                    </widgets>
                                </section>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <or>
                                    <if-has-permission permission="CATALOG" action="_ADMIN"/>
                                    <if-has-permission permission="CATALOG" action="_CREATE"/>
                                    <if-has-permission permission="CATALOG" action="_UPDATE"/>
                                    <if-has-permission permission="CATALOG" action="_VIEW"/>
                                </or>
                            </condition>
                            <widgets>
                                <decorator-section-include name="body"/>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.ProductCatalogViewPermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="CommonShippingDecorator">
        <section>
            <actions>
                <property-map resource="ProductUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="activeSubMenu" from-field="activeSubMenu" default-value="component://product/widget/catalog/CatalogMenus.xml#Shipping" />
                <set field="activeMainMenuItem" from-field="activeMainMenuItem" default-value="store"/>
                <set field="showMainExtendedBar" type="Boolean" value="true" />
                
                <!-- SCIPIO: NOTE: This is workaround for screens that forget to set context var from parameters, so menus can work.
                    Do NOT set this global. -->
                <set field="productStoreId" from-field="productStoreId" default-value="${parameters.productStoreId}"/>
                
                <set field="titleKey" from-field="labelTitleProperty" default-value="${titleProperty}" />
                <set field="title" from-field="title" default-value="${uiLabelMap[titleKey]} ${productStoreId}"/>
                <set field="title" value="${title} ${${extraFunctionName}}" />
                
                <!-- SCIPIO: session-based browsing aid -->
                <script location="component://product/webapp/catalog/WEB-INF/actions/store/GetStoreLastProductStore.groovy"/>
                <!-- re-save it to prevent wild switching -->
                <script location="component://product/webapp/catalog/WEB-INF/actions/store/SetStoreLastProductStore.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonCatalogAppDecorator">
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <section>
                            <condition>
                                <if-has-permission permission="CATALOG" action="_VIEW"/>
                            </condition>
                            <widgets>
                                <include-screen name="MainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                            </widgets>
                            <fail-widgets>
                                <include-screen name="DefMainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                    <decorator-section name="body">
                        <section>
                            <!-- do check for CATALOG, _VIEW permission -->
                            <condition>
                                <if-has-permission permission="CATALOG" action="_VIEW"/>
                            </condition>
                            <widgets>
                                <!--<label style="heading">${uiLabelMap[labelTitleProperty]}</label>-->
                                <decorator-section-include name="body"/>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.ProductCatalogViewPermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="CommonPriceDecorator">
        <section>
            <actions>
                <property-map resource="ProductUiLabels" map-name="uiLabelMap" global="true"/>
                <!-- SCIPIO: NOTE: there is no pricerules sub-menu. -->
                <set field="activeSubMenu" from-field="activeSubMenu" default-value="TOP"/>
                <set field="activeSubMenuItem" from-field="activeSubMenuItem" default-value="pricerules"/>
                <set field="activeMainMenuItem" from-field="activeMainMenuItem" default-value="pricerules"/>
                <set field="showMainExtendedBar" type="Boolean" value="true" />
                
                <set field="titleKey" from-field="labelTitleProperty" default-value="${titleProperty}" />
                <set field="title" from-field="title" default-value="${uiLabelMap[titleKey]} ${parameters.productPriceRuleId}"/>
                <set field="title" value="${title} ${${extraFunctionName}}" />
            </actions>
            <widgets>
                <decorator-screen name="CommonCatalogAppDecorator">
                    <!-- SCIPIO: delegate to common decorator
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <include-screen name="DefMainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                        <include-screen name="leftbar" location="component://product/widget/catalog/CommonScreens.xml"/>
                    </decorator-section>-->    
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                      <section>
                            <!-- do check for CATALOG, _VIEW permission -->
                            <condition>
                                <if-has-permission permission="CATALOG" action="_VIEW"/>
                            </condition>
                            <widgets>
                                <include-screen name="MainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                            </widgets>
                            <fail-widgets>
                                <!-- provide default column for all others -->
                                <include-screen name="DefMainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                            </fail-widgets>
                        </section>
                    </decorator-section>                
                    <decorator-section name="body">
                        <section>
                            <!-- do check for CATALOG, _VIEW permission -->
                            <condition>
                                <if-has-permission permission="CATALOG" action="_VIEW"/>
                            </condition>
                            <widgets>
                                <decorator-section-include name="body"/>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.ProductCatalogViewPermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <!-- SCIPIO: New, transferred from Content app -->
    <screen name="CommonWebSiteDecorator">
        <section>
            <actions>
                <property-map resource="ProductUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="ContentUiLabels" map-name="uiLabelMap" global="true"/>

                <set field="activeSubMenu" from-field="activeSubMenu" default-value="component://content/widget/content/ContentMenus.xml#WebSite" />
                <set field="activeMainMenuItem" from-field="activeMainMenuItem" default-value="store"/>

                <!-- SCIPIO: this should already be done by screen but sometimes it's not. Do NOT make global (local use here only) -->
                <set field="webSiteId" from-field="webSiteId" default-value="${parameters.webSiteId}"/>
                <entity-one entity-name="WebSite" value-field="webSite"/>
                
                <!-- SCIPIO: NOTE: This is workaround for screens that forget to set context var from parameters, so menus can work.
                    Do NOT set this global. -->
                <set field="productStoreId" from-field="productStoreId" default-value="${parameters.productStoreId}"/>
                
                <set field="titleKey" from-field="labelTitleProperty" default-value="${titleProperty}" />
                <set field="title" from-field="title" default-value="${uiLabelMap[titleKey]} ${parameters.webSiteId}"/>
                <set field="title" value="${title} ${${extraFunctionName}}" />

                <!-- SCIPIO: session-based browsing aid -->
                <script location="component://product/webapp/catalog/WEB-INF/actions/store/GetStoreLastProductStore.groovy"/>
                <!-- re-save it to prevent wild switching -->
                <script location="component://product/webapp/catalog/WEB-INF/actions/store/SetStoreLastProductStore.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonCatalogAppDecorator">
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <section>
                            <condition>
                                <and>
                                    <if-has-permission permission="CONTENTMGR" action="_VIEW"/>
                                </and>
                            </condition>
                            <widgets>
                                <include-screen name="MainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                            </widgets>
                            <fail-widgets>
                                <include-screen name="DefMainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="CONTENTMGR" action="_VIEW"/>
                            </condition>
                            <widgets>
                                <!--<container style="button-bar">
                                    <link text="${uiLabelMap.ContentNewWebSite}" target="EditWebSite" style="${styles.link_nav} ${styles.action_add}"/>
                                </container>-->
                                <container>
                                    <include-menu name="websiteMenu" location="component://content/widget/content/ContentMenus.xml"/>
                                </container>
                                <!-- SCIPIO: too verbose, redundant with page title
                                <label style="heading" text="${uiLabelMap[labelTitleProperty]} ${uiLabelMap.CommonFor}: ${webSite.siteName} [${webSite.webSiteId}] ${${extraFunctionName}}"/>
                                -->
                                
                                <decorator-section-include name="body"/>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.ContentViewPermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- SCIPIO: New, transferred from Content app -->
    <screen name="CommonWebAnalyticsDecorator">
        <section>
            <actions>
                <property-map resource="ProductUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="ContentUiLabels" map-name="uiLabelMap" global="true"/>

                <set field="activeSubMenu" from-field="activeSubMenu" default-value="component://content/widget/content/ContentMenus.xml#WebSite" />
                <set field="activeMainMenuItem" from-field="activeMainMenuItem" default-value="store"/>

                <!-- SCIPIO: this should already be done by screen but sometimes it's not. Do NOT make global (local use here only) -->
                <set field="webSiteId" from-field="webSiteId" default-value="${parameters.webSiteId}"/>
                <entity-one entity-name="WebSite" value-field="webSite"/>
                
                <!-- SCIPIO: NOTE: This is workaround for screens that forget to set context var from parameters, so menus can work.
                    Do NOT set this global. -->
                <set field="productStoreId" from-field="productStoreId" default-value="${parameters.productStoreId}"/>

                <set field="titleKey" from-field="labelTitleProperty" default-value="${titleProperty}" />
                <set field="title" from-field="title" default-value="${uiLabelMap[titleKey]} ${parameters.webSiteId}"/>
                <set field="title" value="${title} ${${extraFunctionName}}" />

                <!-- SCIPIO: session-based browsing aid -->
                <script location="component://product/webapp/catalog/WEB-INF/actions/store/GetStoreLastProductStore.groovy"/>
                <!-- re-save it to prevent wild switching -->
                <script location="component://product/webapp/catalog/WEB-INF/actions/store/SetStoreLastProductStore.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonCatalogAppDecorator">
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <section>
                            <condition>
                                <and>
                                    <if-has-permission permission="CONTENTMGR" action="_VIEW"/>
                                </and>
                            </condition>
                            <widgets>
                                <include-screen name="MainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                            </widgets>
                            <fail-widgets>
                                <include-screen name="DefMainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                    <decorator-section name="body">
                        <section>
                            <widgets>
                                <container style="button-bar">
                                    <include-menu name="WebAnalyticsConfigButtonBar" location="component://content/widget/content/ContentMenus.xml"/>
                                </container>
                                <!-- SCIPIO: too verbose/redundant
                                <label style="heading" text="${uiLabelMap.CatalogWebAnalytics} ${uiLabelMap.CommonFor} : ${webSite.siteName} [${webSite.webSiteId}]  ${${extraFunctionName}}"/>
                                -->
                                <decorator-section-include name="body"/>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.ContentViewPermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <!-- SCIPIO: New, transferred from Content app -->
    <screen name="CommonContentDecorator">
        <section>
            <actions>
                <property-map resource="ProductUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="ContentUiLabels" map-name="uiLabelMap" global="true"/>
                <set field="activeSubMenu" from-field="activeSubMenu" default-value="component://content/widget/content/ContentMenus.xml#Content" />
                <set field="activeMainMenuItem" from-field="activeMainMenuItem" default-value=""/><!-- SCIPIO: NOTE: nothing for now, this is too generic... -->
            </actions>
            <widgets>
                <!-- NOTE: for now this SHOULD delegate to content because many webapps may use this pattern; whereas WebSite is only accessible from catalog -->
                <decorator-screen name="CommonContentDecorator" location="component://content/widget/CommonScreens.xml">
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <section>
                            <condition>
                                <if-has-permission permission="CONTENTMGR" action="_VIEW"/>
                            </condition>
                            <widgets>
                                <include-screen name="MainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                            </widgets>
                            <fail-widgets>
                                <include-screen name="DefMainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="leftbar">
        <section>
            <widgets>
                <!-- <include-screen name="keywordsearchbox"/> -->
                <!--<include-screen name="sidecatalogs"/>
                <include-screen name="sidedeepcategory"/>
                <include-screen name="categorytree"/>
                <include-screen name="miniproductlist"/>-->
            </widgets>
        </section>
    </screen>

    <screen name="keywordsearchbox">
        <section>
            <actions>
                <script location="component://product/webapp/catalog/WEB-INF/actions/find/keywordsearchbox.groovy"/>
            </actions>
            <widgets>
                <screenlet id="ProductKeywordsPanel" title="${uiLabelMap.ProductSearchProducts}" collapsible="true">
                    <platform-specific><html><html-template location="component://product/webapp/catalog/find/keywordsearchbox.ftl"/></html></platform-specific>
                </screenlet>
            </widgets>
        </section>
    </screen>
    <screen name="sidecatalogs">
        <section>
            <actions>
                <script location="component://product/webapp/catalog/WEB-INF/actions/find/sidecatalogs.groovy"/>
            </actions>
            <widgets>
                <screenlet id="ProductBrowseCatalogsPanel" title="${uiLabelMap.ProductBrowseCatalogs}" collapsible="true">
                    <platform-specific><html><html-template location="component://product/webapp/catalog/find/sidecatalogs.ftl"/></html></platform-specific>
                </screenlet>
            </widgets>
        </section>
    </screen>
    <screen name="sidedeepcategory">
        <section>
            <actions>
                <script location="component://product/webapp/catalog/WEB-INF/actions/find/sidedeepcategory.groovy"/>
            </actions>
            <widgets>
                <screenlet id="ProductBrowseCategoriesPanel" title="${uiLabelMap.ProductBrowseCategories}" collapsible="true">
                    <platform-specific><html><html-template location="component://product/webapp/catalog/find/sidedeepcategory.ftl"/></html></platform-specific>
                </screenlet>
            </widgets>
        </section>
    </screen>
    <screen name="miniproductlist">
        <section>
            <actions>
                <script location="component://product/webapp/catalog/WEB-INF/actions/find/miniproductlist.groovy"/>
            </actions>
            <widgets>
                <screenlet id="ProductCategoryProductsPanel" title="${uiLabelMap.ProductCategoryProducts}" collapsible="true">
                    <container id="miniproductlist">
                        <platform-specific><html><html-template location="component://product/webapp/catalog/find/miniproductlist.ftl"/></html></platform-specific>
                    </container>
                </screenlet>
            </widgets>
        </section>
    </screen>
    <screen name="ChooseTopCategory">
        <section>
            <actions>
                <set field="titleProperty" value="PageTitleChooseTopCategory"/>
                <script location="component://product/webapp/catalog/WEB-INF/actions/ChooseTopCategory.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonCatalogAppDecorator">
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <include-screen name="leftbar"/>
                    </decorator-section>                    
                    <decorator-section name="body">
                        <container style="button-bar">
                            <link target="EditCategory" text="${uiLabelMap.ProductNewCategory}" style="${styles.link_nav} ${styles.action_add}"/>
                        </container>
                        <screenlet title="${uiLabelMap.ProductCategoryWithNoParent}">
                            <include-form name="ListTopCategory" location="component://product/widget/catalog/CategoryForms.xml"/>
                        </screenlet>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    <screen name="FastLoadCache">
        <section>
            <actions>
                <set field="titleProperty" value="ProductFastLoadCatalogIntoCache"/>
                <script location="component://product/webapp/catalog/WEB-INF/actions/FastLoadCache.groovy"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonCatalogAppDecorator">
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <include-screen name="leftbar"/>
                    </decorator-section>                    
                    <decorator-section name="body">
                        <platform-specific><html><html-template location="component://product/webapp/catalog/FastLoadCache.ftl"/></html></platform-specific>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="categorytree">
        <section>
            <actions>
                <script location="component://product/webapp/catalog/WEB-INF/actions/category/CategoryTree.groovy"/>
            </actions>
            <widgets>
                <screenlet id="ProductBrowseCategoriesPanel" title="${uiLabelMap.ProductBrowseCatalogeAndCategories}" collapsible="true">
                    <container id="EditDocumentTree"/>
                    <platform-specific><html><html-template location="component://product/webapp/catalog/category/CategoryTree.ftl"/></html></platform-specific>
                </screenlet>
            </widgets>
        </section>
    </screen>

    <screen name="ProductStoreGroupTree">
        <section>
            <actions>
                <entity-one value-field="parentProductStoreGroup" entity-name="ProductStoreGroup"/>
                <entity-condition entity-name="ProductStoreGroup" list="parentProductStoreGroups">
                    <condition-expr field-name="primaryParentGroupId" from-field="nullField"/>
                </entity-condition>
            </actions>
            <widgets>
                <screenlet id="ProductStoreGroupPanel" title="${uiLabelMap.ProductParentProductStoreGroups}" collapsible="true">
                    <container id="EditDocumentTree"/>
                    <platform-specific><html><html-template location="component://product/webapp/catalog/store/ProductStoreGroupTree.ftl"/></html></platform-specific>
                </screenlet>
            </widgets>
        </section>
    </screen>

    <screen name="main">
        <section>
            <actions>
                <set field="activeMainMenuItem" value="main"/>
                <set field="activeSubMenuItem" from-field="activeMainMenuItem"/>
                <set field="titleProperty" value="ProductCatalogManager"/>
            </actions>
            <widgets>            
                <decorator-screen name="CommonCatalogAppDecorator">
                    <decorator-section name="body">
                        <container style="${styles.grid_row}">
                            <container style="${styles.grid_large}6 ${styles.grid_cell}">
                                <section>
                                   <actions>
                                       <!-- SCIPIO: FIXME: Unhardcode this -->
                                       <set field="productStoreId" value="ScipioShop" global="true"/>
                                   </actions>
                                   <widgets>
                                       <include-screen name="ScipioStoreCatalogTree"/>   
                                   </widgets>
                               </section>
                            </container>
                            <container style="${styles.grid_large}6 ${styles.grid_cell}">
                                <section>
                                   <actions>
                                       <set field="productStoreId" value="RentalStore" global="true"/>
                                   </actions>
                                   <widgets>
                                       <include-screen name="ScipioStoreCatalogTree"/>   
                                   </widgets>
                               </section>
                            </container>
                        </container>
                        <container style="${styles.grid_row}">
                            <container style="${styles.grid_large}6 ${styles.grid_cell}">
                                <include-screen name="ScipioRecentProductsAdded"/>
                            </container>
                            <container style="${styles.grid_large}6 ${styles.grid_cell}">

                            </container>
                        </container>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
     </screen>

    <screen name="ImageManagementDecorator">
        <section>
            <actions>
                <set field="activeSubMenu" from-field="activeSubMenu" default-value="component://product/widget/catalog/CatalogMenus.xml#ImageManagement" />
                <set field="activeMainMenuItem" from-field="activeMainMenuItem" default-value="Imagemanagement"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonCatalogAppDecorator">
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <include-screen name="MainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                        <include-screen name="leftbar"/>
                    </decorator-section>
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-has-permission permission="CATALOG" action="_VIEW"/>
                            </condition>
                            <widgets>
                                <decorator-section-include name="body"/>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.ProductCatalogViewPermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="CommonReviewDecorator">
        <section>
            <actions>
                <set field="showMainExtendedBar" type="Boolean" value="true" />
                <set field="activeSubMenu" from-field="activeSubMenu" default-value="TOP" />
                
                <set field="activeMainMenuItem" from-field="activeMainMenuItem" default-value="reviews"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonCatalogAppDecorator">
                    <!-- SCIPIO: delegate to common decorator
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <include-screen name="DefMainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                        <include-screen name="leftbar" location="component://product/widget/catalog/CommonScreens.xml"/>
                    </decorator-section>-->                   
                    <decorator-section name="body">
                        <section>
                            <!-- do check for CATALOG, _VIEW permission -->
                            <condition>
                                <if-has-permission permission="CATALOG" action="_VIEW"/>
                            </condition>
                            <widgets>
                                <decorator-section-include name="body"/>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.ProductCatalogViewPermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>

    <screen name="CommonThesaurusDecorator">
        <section>
            <actions>
                <set field="showMainExtendedBar" type="Boolean" value="true" />
                <set field="activeMainMenuItem" from-field="activeMainMenuItem" default-value="thesaurus"/>
            </actions>
            <widgets>
                <decorator-screen name="CommonCatalogAppDecorator">
                    <!-- SCIPIO: delegate to common decorator
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <include-screen name="DefMainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                        <include-screen name="leftbar" location="component://product/widget/catalog/CommonScreens.xml"/>
                    </decorator-section>-->
                    <decorator-section name="body">
                        <section>
                            <!-- do check for CATALOG, _VIEW permission -->
                            <condition>
                                <if-has-permission permission="CATALOG" action="_VIEW"/>
                            </condition>
                            <widgets>
                                <decorator-section-include name="body"/>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.ProductCatalogViewPermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="CommonSubscriptionDecorator">
        <section>
            <actions>
                <set field="activeMainMenuItem" from-field="activeMainMenuItem" default-value="Subscription"/>
                <set field="subscriptionId" from-field="parameters.subscriptionId"/>
                <entity-one entity-name="Subscription" value-field="subscription"/>
                <set field="showMainExtendedBar" type="Boolean" value="true" />
                
                <set field="titleKey" from-field="labelTitleProperty" default-value="${titleProperty}" />
                <set field="title" from-field="title" default-value="${uiLabelMap[titleKey]} ${parameters.subscriptionId}"/>
                <set field="title" value="${title} ${${extraFunctionName}}" />
            </actions>
            <widgets>
                <decorator-screen name="CommonCatalogAppDecorator">
                    <!-- SCIPIO: delegate to common decorator
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <include-screen name="DefMainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                        <include-screen name="leftbar" location="component://product/widget/catalog/CommonScreens.xml"/>
                    </decorator-section>-->                    
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-service-permission service-name="subscriptionPermissionCheck" main-action="VIEW"/>
                            </condition>
                            <widgets>
                                <section>
                                    <condition>
                                        <not><if-empty field="subscription"/></not>
                                    </condition>
                                    <widgets>
                                    <include-menu name="EditSubscription" location="component://product/widget/catalog/SubscriptionMenus.xml"/>
                                        <container style="button-bar">
                                            <link target="EditSubscription" text="${uiLabelMap.ProductNewSubscription}" style="${styles.link_nav} ${styles.action_add}"/>
                                        </container>
                                        <!--
                                        <section>
                                            <condition>
                                                <not><if-empty field="title"/></not>
                                            </condition>
                                            <widgets>
                                                <label style="heading">${title} ${uiLabelMap.CommonFor} ${subscription.description} [${subscriptionId}]</label>
                                            </widgets>
                                            <fail-widgets>
                                                <label style="heading">${uiLabelMap[titleProperty]} ${uiLabelMap.CommonFor} ${subscription.description} [${subscriptionId}]</label>
                                            </fail-widgets>
                                        </section>  -->
                                    </widgets>
                                    <fail-widgets>
                                        <section>
                                            <condition>
                                                <if-compare operator="not-equals" value="EditSubscription" field="activeSubMenuItem"/>
                                            </condition>
                                            <widgets>
                                                <container style="button-bar"><link target="EditSubscription" text="${uiLabelMap.ProductNewSubscription}" style="${styles.link_nav} ${styles.action_add}"/></container>
                                            </widgets>
                                        </section>
                                    </fail-widgets>
                                </section>
                                <decorator-section-include name="body"/>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.ProductSubscriptionViewPermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="CommonSubscriptionResourceDecorator">
        <section>
            <actions>
                <set field="activeMainMenuItem" from-field="activeMainMenuItem" default-value="Subscription"/>
                <set field="subscriptionResourceId" from-field="parameters.subscriptionResourceId"/>
                <entity-one entity-name="SubscriptionResource" value-field="subscriptionResource"/>
                <set field="showMainExtendedBar" type="Boolean" value="true" />
                
                <set field="titleKey" from-field="labelTitleProperty" default-value="${titleProperty}" />
                <set field="title" from-field="title" default-value="${uiLabelMap[titleKey]} ${parameters.subscriptionResourceId}"/>
                <set field="title" value="${title} ${${extraFunctionName}}" />
            </actions>
            <widgets>
                <decorator-screen name="CommonCatalogAppDecorator">
                    <!-- SCIPIO: delegate to common decorator
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <include-screen name="DefMainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                        <include-screen name="leftbar" location="component://product/widget/catalog/CommonScreens.xml"/>
                    </decorator-section>-->
                    <decorator-section name="body">
                        <section>
                            <condition>
                                <if-service-permission service-name="subscriptionPermissionCheck" main-action="VIEW"/>
                            </condition>
                            <widgets>
                                <section>
                                    <condition>
                                        <not><if-empty field="subscriptionResource"/></not>
                                    </condition>
                                    <widgets>
                                        <include-menu name="EditSubscriptionResource" location="component://product/widget/catalog/SubscriptionMenus.xml"/>
                                        <container style="button-bar">
                                            <link target="EditSubscriptionResource" text="${uiLabelMap.ProductNewSubscriptionResource}" style="${styles.link_nav} ${styles.action_add}"/>
                                            <link target="FindSubscription" text="${uiLabelMap.ProductFindResourceSubscriptions}" style="${styles.link_nav} ${styles.action_find}">
                                                <parameter param-name="subscriptionResourceId"/>
                                            </link>
                                        </container>
                                        <!--
                                        <section>
                                            <condition>
                                                <not><if-empty field="title"/></not>
                                            </condition>
                                            <widgets>
                                                <label style="heading">${title} ${uiLabelMap.CommonFor} "${subscriptionResource.description}" [${subscriptionResourceId}]</label>
                                            </widgets>
                                            <fail-widgets>
                                                <label style="heading">${uiLabelMap[titleProperty]} ${uiLabelMap.CommonFor} "${subscriptionResource.description}" [${subscriptionResourceId}]</label>
                                            </fail-widgets>
                                        </section>
                                        -->
                                    </widgets>
                                    <fail-widgets>
                                        <section>
                                            <condition>
                                                <not><if-empty field="title"/></not>
                                            </condition>
                                            <widgets>
                                                <label style="heading">${title}</label>
                                            </widgets>
                                            <fail-widgets>
                                                <label style="heading">${uiLabelMap[titleProperty]}</label>
                                            </fail-widgets>
                                        </section>
                                    </fail-widgets>
                                </section>
                                <decorator-section-include name="body"/>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.ProductSubscriptionResourceViewPermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="CommonFindDecorator">
        <section>
            <actions>
                <set field="showMainExtendedBar" type="Boolean" value="true" />
            </actions>
            <widgets>
                <decorator-screen name="CommonCatalogAppDecorator">
                    <!-- SCIPIO: delegate to common decorator
                    <decorator-section name="left-column" use-when="${context.widePage != true}" override-by-auto-include="true">
                        <include-screen name="DefMainSideBarMenu" location="${parameters.mainDecoratorLocation}"/>
                        <include-screen name="leftbar" location="component://product/widget/catalog/CommonScreens.xml"/>
                    </decorator-section>-->                    
                    <decorator-section name="body">
                        <section>
                            <!-- do check for CATALOG, _VIEW permission -->
                            <condition>
                                <if-has-permission permission="CATALOG" action="_VIEW"/>
                            </condition>
                            <widgets>
                                <decorator-section-include name="body"/>
                            </widgets>
                            <fail-widgets>
                                <label style="common-msg-error-perm">${uiLabelMap.ProductCatalogViewPermissionError}</label>
                            </fail-widgets>
                        </section>
                    </decorator-section>
                </decorator-screen>
            </widgets>
        </section>
    </screen>
    
    <screen name="listMiniproduct">
        <section>
            <actions>
                <property-map resource="ProductUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="CommonUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="WorkEffortUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="PartyUiLabels" map-name="uiLabelMap" global="true"/>
                <property-map resource="AccountingUiLabels" map-name="uiLabelMap" global="true"/>
                <script location="component://product/webapp/catalog/WEB-INF/actions/find/miniproductlist.groovy"/>
            </actions>
            <widgets>
                    <platform-specific><html><html-template location="component://product/webapp/catalog/find/miniproductlist.ftl"/></html></platform-specific>
            </widgets>
        </section>
    </screen>

    
    <!-- SCIPIO: Widget implementation -->
    <screen name="ScipioStoreCatalogTree">
        <section>
            <actions>
               <entity-one value-field="productStore" entity-name="ProductStore"/>
               <script location="component://product/script/com/ilscipio/product/dashboard/StoreCatalogTree.groovy"/>
           </actions>
           <widgets>
                <section>
                    <condition>
                        <not>
                            <if-empty field="treeMenuData"/>
                        </not>
                    </condition>
                     <widgets>
                       <screenlet title="${productStore.storeName}">
                           <platform-specific><html><html-template location="component://product/webapp/catalog/dashboard/storeCatalogTree.ftl"/></html></platform-specific>
                       </screenlet>     
                   </widgets>
                </section>
           </widgets>
        </section>
    </screen>
    
    <screen name="ScipioRecentProductsAdded">
        <section>
            <actions>
                <script location="component://product/script/com/ilscipio/product/dashboard/NewProducts.groovy"/>
            </actions>
            <widgets>
                <section>
                    <condition>
                        <not>
                            <if-empty field="products"/>
                        </not>
                    </condition>
                     <widgets>
                        <screenlet title="${uiLabelMap.ProductRecentProductsAdded}">
                            <include-form name="newProducts" location="component://product/widget/catalog/CatalogForms.xml"/>
                        </screenlet>
                    </widgets>
                </section>
            </widgets>
        </section>
    </screen>
    
    <screen name="ScipioPromotionsList">
        <section>
            <actions>
                <set field="userEntered" from-field="parameters.userEntered"/>
                <entity-condition entity-name="ProductPromo" list="productPromos">
                    <condition-expr field-name="userEntered" from-field="userEntered" ignore-if-empty="true"/>
                    <order-by field-name="-createdDate"/>
                </entity-condition>     
            </actions>
            <widgets>
                <section>
                    <condition>
                        <not>
                            <if-empty field="productPromos"/>
                        </not>
                    </condition>
                     <widgets>
                        <screenlet title="${uiLabelMap.ProductProductPromotionsList}">
                            <include-form name="ListProductPromos" location="component://product/widget/catalog/PromoForms.xml"/>
                        </screenlet>
                    </widgets>
                </section>
            </widgets>
        </section>
    </screen>
    
    <!-- SCIPIO: Main SideBar Menu (see component://common/widget/CommonScreens.xml#ComplexSideBarMenu for available arguments) -->
    <screen name="MainSideBarMenu">
        <section>
            <actions>
                <set field="menuCfg.location" value="component://product/widget/catalog/CatalogMenus.xml"/>
                <set field="menuCfg.name" value="CatalogAppSideBar"/>
                <set field="menuCfg.defLocation" value="component://product/widget/catalog/CatalogMenus.xml"/>
            </actions>
            <widgets>
                <include-screen location="component://common/widget/CommonScreens.xml" name="ComplexSideBarMenu"/>
            </widgets>
        </section>
    </screen>
    
    <!-- SCIPIO: Default Main SideBar Menu, version of MainSideBarMenu that disregards screen's selected/active sub-menu -->
    <screen name="DefMainSideBarMenu">
        <section>
            <actions>
                <script location="component://common/webcommon/WEB-INF/actions/includes/scipio/PrepareDefComplexSideBarMenu.groovy"/>
            </actions>
            <widgets>
                <include-screen name="MainSideBarMenu"/>
            </widgets>
        </section>
    </screen>
    
    <!-- SCIPIO: Common SideBar Menu inclusion logic, for/from Common*AppDecorator, with application-specific logic (see component://common/widget/CommonScreens.xml#CommonSideBarMenu for available arguments)
        NOTE: Unlike MainSideBarMenu and DefMainSideBarMenu, should always be DIRECT-included using hardcoded location, NOT mainDecoratorLocation -->
    <screen name="CommonSideBarMenu">
        <section>
            <actions>
                <set field="commonSideBarMenu.perm" from-field="commonSideBarMenu.perm" default-value="CATALOG"/>
                <set field="commonSideBarMenu.permAction" from-field="commonSideBarMenu.permAction" default-value="_VIEW"/>
            </actions>
            <widgets>
                <include-screen name="CommonSideBarMenu" location="component://common/widget/CommonScreens.xml"/>
            </widgets>
        </section>
    </screen>
    
</screens>
