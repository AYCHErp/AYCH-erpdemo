<?xml version="1.0" encoding="UTF-8"?>
<entitymodel xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="http://ofbiz.apache.org/dtds/entitymodel.xsd">
    <!-- ========================================================= -->
    <!-- ======================== Scipio CMS ======================= -->
    <!-- ========================================================= -->
    <title>Entity of CMS Component</title>
    <description>Page templates, assets, content and version entities concerning the creation and administration of content on pages.</description>
    <copyright>Ilscipio GmbH</copyright>
    <version>1.0</version>

 <entity entity-name="CmsPageTemplate"
         title="Page Template Entity"
         author="Ilscipio GmbH" version="1.0"
         package-name="com.ilscipio.scipio.cms.template"
         table-name="CMS_PAGE_TEMPLATE">
           
      <field name="pageTemplateId" type="id-ne"></field>
      <field name="webSiteId" type="id"></field>
      <field name="templateName" type="name"></field>
      <field name="createdBy" type="id"></field>
      <field name="lastUpdatedBy" type="id"></field>
            
      <prim-key field="pageTemplateId" />
    </entity>
    
    <entity title="Asset Template Entity"
           entity-name="CmsAssetTemplate"
           table-name="CMS_ASSET_TEMPLATE"    
           author="Ilscipio GmbH" version="1.0"
           package-name="com.ilscipio.scipio.cms.template">
           
      <field name="assetTemplateId" type="id-ne"></field>
      <field name="webSiteId" type="id"></field>
      <field name="templateName" type="name"></field>
      <field name="templateBody" type="very-long"></field>
      <field name="inactive" type="indicator"></field>      
      <field name="createdBy" type="id"></field>
      <field name="lastUpdatedBy" type="id"></field>           
      <prim-key field="assetTemplateId" />
      
    </entity>
    
    <entity title="Attribute Template Entity"
           entity-name="CmsAttributeTemplate"
           table-name="CMS_ATTRIBUTE_TEMPLATE"    
           author="Ilscipio GmbH" version="1.0"
           package-name="com.ilscipio.scipio.cms.template">
           
      <field name="attributeTemplateId" type="id-ne"></field>
      <field name="assetTemplateId" type="id"></field>
      <field name="pageTemplateId" type="id"></field>
      
      <field name="attributeName" type="name"></field>
      <field name="displayName" type="name"></field>
      <field name="defaultValue" type="long-varchar"></field>
      <field name="inputHelp" type="long-varchar"></field>
      <field name="inputType" type="id"></field>
      <field name="permission" type="id"></field>
      <field name="markdown" type="indicator"></field>      
      <field name="inputPosition" type="numeric"></field>
      <field name="maxLength" type="numeric"></field>      
      <field name="regexp" type="long-varchar"></field>        
      <field name="required" type="indicator"></field>
      
      <prim-key field="attributeTemplateId" />
      
      <relation type="one" fk-name="ATTMPL_ASSET" rel-entity-name="CmsAssetTemplate">
        <key-map field-name="assetTemplateId"/>
      </relation>
      
      <relation type="one" fk-name="ATTMPL_TEMPLATE" rel-entity-name="CmsPageTemplate">
        <key-map field-name="pageTemplateId"/>
      </relation>      

    </entity>    
        
    
    <entity title="Asset To Page Template Association"
           entity-name="CmsPageAssetTemplateAssoc"
           table-name="CMS_PAGE_ASSET_TEMPLATE_ASSOC"    
           author="Ilscipio GmbH" version="1.0"
           package-name="com.ilscipio.scipio.cms.template">
 
      <field name="pageAssetTemplateAssocId" type="id-ne"></field>
      <field name="assetTemplateId" type="id"></field>
      <field name="pageTemplateId" type="id"></field>      
      <field name="importName" type="name"></field>
      <field name="inputPosition" type="numeric"></field>
      
      <prim-key field="pageAssetTemplateAssocId" />
      
      <relation type="one" fk-name="PATMPLASSOC_PAGE" rel-entity-name="CmsPageTemplate">
        <key-map field-name="pageTemplateId"/>
      </relation>
      <relation type="one" fk-name="PATMPLASSOC_ASSET" rel-entity-name="CmsAssetTemplate">
        <key-map field-name="assetTemplateId"/>
      </relation>
    </entity>
    
     <entity title="Groovy Template Entity"
           entity-name="CmsGroovyTemplate"
           table-name="CMS_GROOVY_TEMPLATE"    
           author="Ilscipio GmbH" version="1.0"
           package-name="com.ilscipio.scipio.cms.template">
           
      <field name="groovyTemplateId" type="id-ne"></field>
      <field name="templateName" type="name"></field>
      <field name="templateLocation" type="long-varchar"></field>
      <field name="templateBody" type="very-long"></field>      
      <field name="createdBy" type="id"></field>      
      <prim-key field="groovyTemplateId" />
    </entity>

    
    <entity title="Groovy To Page Template Association"
           entity-name="CmsPageTemplateGroovyAssoc"
           table-name="CMS_PAGE_TEMPLATE_GROOVY_ASSOC"    
           author="Ilscipio GmbH" version="1.0"
           package-name="com.ilscipio.scipio.cms.template">
 
      <field name="groovyAssocId" type="id-ne"></field>
      <field name="groovyTemplateId" type="id"></field>
      <field name="pageTemplateId" type="id"></field>      
      <field name="inputPosition" type="numeric"></field>
      <field name="lastUpdatedBy" type="id"></field>                
      <prim-key field="groovyAssocId" />
      
      <relation type="one" fk-name="PGTMPLASSOC_PAGE" rel-entity-name="CmsPageTemplate">
        <key-map field-name="pageTemplateId"/>
      </relation>
      <relation type="one" fk-name="PGTMPLASSOC_ASSET" rel-entity-name="CmsGroovyTemplate">
        <key-map field-name="groovyTemplateId"/>
      </relation>
    </entity>
    
           
    <entity title="Page"
           entity-name="CmsPage"
           table-name="CMS_PAGE"    
           author="Ilscipio GmbH" version="1.0"
           package-name="com.ilscipio.scipio.cms.content">
           
      <field name="pageId" type="id-ne"></field>
      <field name="webSiteId" type="id"></field>
      <field name="pageTemplateId" type="id"></field>      
      <field name="pagePath" type="long-varchar"></field>
      <field name="pageName" type="name"></field>
      <field name="activeVersionId" type="id"></field>          
      <prim-key field="pageId" />
      
      <relation type="one" fk-name="PTMPLASSOC_PAGE" rel-entity-name="CmsPageTemplate">
        <key-map field-name="pageTemplateId"/>
      </relation>
      <relation type="one" fk-name="PVERSASSOC_PAGE" rel-entity-name="CmsPageVersion">
        <key-map field-name="activeVersionId" rel-field-name="pageVersionId"/>
      </relation> 
      
      <index name="pageIdIndex" unique="true">
        <description>The proper indeces should help reduce the lookup times on the db</description>
        <index-field name="pageId"/>
      </index>
      <index name="websiteIdIndex" unique="true">
        <description>The proper indeces should help reduce the lookup times on the db</description>
        <index-field name="websiteIdIndex"/>
      </index>    
    </entity>
    
    
    <entity title="Page Authorization"
           entity-name="CmsPageAuthorization"
           table-name="CMS_PAGE_AUTHORIZATION"    
           author="Ilscipio GmbH" version="1.0"
           package-name="com.ilscipio.scipio.cms.auth">
           
      <field name="pageAuthId" type="id-ne" ></field>
      <field name="pageId" type="id"></field>
      <field name="userId" type="id-vlong-ne"></field>
      <field name="roleTypeId" type="id"></field>
      <field name="groupId" type="id">
        <description>Can be used as an alternate to userId to specify a security group of users to which to
          assign the given role type. Only one of the two may be set.</description>
      </field>

      <prim-key field="pageAuthId" />
      
      <relation type="one" fk-name="PAASSOC_PAGE" rel-entity-name="CmsPage">
        <key-map field-name="pageId"/>
      </relation>
      <relation type="one" fk-name="PAASSOC_USERS" rel-entity-name="UserLogin">
        <key-map field-name="userId" rel-field-name="userLoginId"/>
      </relation>
      <relation type="one" fk-name="PAASSOC_ROLETYPE" rel-entity-name="RoleType">
        <key-map field-name="roleTypeId"/>
      </relation>
      <relation type="one" fk-name="PAASSOC_SECGRP" rel-entity-name="SecurityGroup">
        <key-map field-name="groupId" rel-field-name="groupId"/>
      </relation>
    </entity>
    
    <view-entity entity-name="CmsPageUserAuth" package-name="com.ilscipio.scipio.cms.content">
      <member-entity entity-alias="PPA" entity-name="CmsPageAuthorization" />
      
      <alias-all entity-alias="PPA" />
      
      <entity-condition>
        <condition-list>
          <condition-expr entity-alias="PPA" field-name="userId" operator="not-equals" value=""/>
          <condition-expr entity-alias="PPA" field-name="groupId" operator="equals" value=""/>
        </condition-list>
      </entity-condition>
    </view-entity>
    
    <view-entity entity-name="CmsPageGroupAuth" package-name="com.ilscipio.scipio.cms.content">
      <member-entity entity-alias="PPA" entity-name="CmsPageAuthorization" />
      
      <alias-all entity-alias="PPA" />
      
      <entity-condition>
        <condition-list>
          <condition-expr entity-alias="PPA" field-name="groupId" operator="not-equals" value=""/>
          <condition-expr entity-alias="PPA" field-name="userId" operator="equals" value=""/>
        </condition-list>
      </entity-condition>
    </view-entity>  
    
    <view-entity entity-name="CmsPageGroupAuthAndSecurityGroup" package-name="com.ilscipio.scipio.cms.content">
      <member-entity entity-alias="PPGA" entity-name="CmsPageGroupAuth" />
      <member-entity entity-alias="SG" entity-name="SecurityGroup" />
      
      <alias-all entity-alias="PPGA" />
      <alias entity-alias="SG" field="description" name="groupDesc"/>
      
      <view-link entity-alias="PPGA" rel-entity-alias="SG">
        <key-map field-name="groupId" rel-field-name="groupId" />
      </view-link>
    </view-entity>    
        
    <entity title="Page Product Association"
           entity-name="CmsPageProductAssoc"
           table-name="CMS_PAGE_PRODUCT_ASSOC"    
           author="Ilscipio GmbH" version="1.0"
           package-name="com.ilscipio.scipio.cms.content">
           
      <field name="pageProductAssocId" type="id-ne" ></field>
      <field name="pageId" type="id"></field>
      <field name="productId" type="id"></field>
      <field name="importName" type="name"></field>      
      <prim-key field="pageProductAssocId" />      
      
      <relation type="one" fk-name="PPASSOC_PAGE" rel-entity-name="CmsPage">
        <key-map field-name="pageId"/>
      </relation>
      <relation type="one" fk-name="PPASSOC_PRODUCT" rel-entity-name="Product">
        <key-map field-name="productId"/>
      </relation>  
    </entity>
    
    <entity title="Page Version"
           entity-name="CmsPageVersion"
           table-name="CMS_PAGE_VERSION"    
           author="Ilscipio GmbH" version="1.0"
           package-name="com.ilscipio.scipio.cms.content">
           
      <field name="pageVersionId" type="id-ne"></field>
      <field name="pageId" type="id"></field>      
      <field name="versionComment" type="long-varchar"></field>
      <field name="content" type="very-long"></field>            
      <field name="createdBy" type="id"></field>
      
      <prim-key field="pageVersionId" />
      
      <relation type="one" fk-name="PVERASSOC_VERSION" rel-entity-name="CmsPage">
        <key-map field-name="pageId"/>
      </relation>
    </entity>
    
    <extend-entity entity-name="RoleType">
      <field name="sequenceNum" type="numeric"></field>
    </extend-entity>
    
    <entity title="Active Template Record"
           entity-name="CmsPageActiveTmpRecord"
           table-name="CMS_PAGE_ACTIVE_TMP_RECORD"    
           author="Ilscipio GmbH" version="1.0"
           package-name="com.ilscipio.scipio.cms.template">   
          
      <field name="pageTemplateId" type="id"></field>      
      <field name="versionId" type="id-ne"></field>
      
      <prim-key field="pageTemplateId" />
      
      <relation type="one" fk-name="CMSPATR_PAGETMP" rel-entity-name="CmsPageTemplate">
        <key-map field-name="pageTemplateId"/>
      </relation>
      <relation type="one" fk-name="CMSPATR_VERSION" rel-entity-name="CmsPageTemplateVersion">
        <key-map field-name="versionId"/>
      </relation>
    </entity> 
    
    <entity title="Template Version"
           entity-name="CmsPageTemplateVersion"
           table-name="CMS_PAGE_TEMPLATE_VERSION"    
           author="Ilscipio GmbH" version="1.0"
           package-name="com.ilscipio.scipio.cms.template">
           
      <field name="versionId" type="id-ne"></field>
      <field name="pageTemplateId" type="id"></field>      
      <field name="versionComment" type="long-varchar"></field>
      <field name="templateBody" type="very-long"></field>            
      <field name="createdBy" type="id"></field>
      <field name="origVersionDate" type="date-time">
        <description>This field is used if the default timestamp fields don't reflect the logical version date.</description>
      </field>
      
      <prim-key field="versionId" />
      
      <relation type="one" fk-name="CMSPTMP_PAGETMP" rel-entity-name="CmsPageTemplate">
        <key-map field-name="pageTemplateId"/>
      </relation>
    </entity>   
</entitymodel>